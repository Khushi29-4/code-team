<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Team Code Wall</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    .code-card {
      background: #f3f3f3;
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 15px;
    }
    pre { background: #222; color: #fff; padding: 10px; border-radius: 5px; }
    button { margin-right: 8px; padding: 5px 10px; }
  </style>
</head>
<body>
  <h2>Team Code Wall ðŸ§©</h2>

  <form id="codeForm">
    <input type="hidden" id="id" />
    <input type="text" id="name" placeholder="Your Name" required><br><br>
    <input type="text" id="description" placeholder="Description" required><br><br>
    <textarea id="code" placeholder="Paste your code here" rows="6" required></textarea><br><br>
    <input type="text" id="image" placeholder="Image URL (optional)"><br><br>
    <button type="submit">Submit</button>
  </form>

  <hr>
  <div id="dataList"></div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyB2p2AZJAsL1cGsP6yozie_1VXhbT0IJea9i-5hlqyrpRHcprZJ4WfUtBYrAUA-ulWIQ/exec";

    // ðŸŸ¢ Submit / Edit Form
    document.getElementById("codeForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const id = document.getElementById("id").value;
      const name = document.getElementById("name").value;
      const description = document.getElementById("description").value;
      const code = document.getElementById("code").value;
      const image = document.getElementById("image").value;

      const formData = new FormData();
      formData.append("action", id ? "edit" : "add");
      formData.append("id", id);
      formData.append("name", name);
      formData.append("description", description);
      formData.append("code", code);
      formData.append("image", image);

      const response = await fetch(scriptURL, { method: "POST", body: formData });
      alert(await response.text());
      loadData();
      e.target.reset();
      document.getElementById("id").value = "";
    });

    // ðŸ” Load Data from Google Sheet
    async function loadData() {
      const res = await fetch(scriptURL + "?action=get");
      const text = await res.text();
      try {
        const data = JSON.parse(text);
        const container = document.getElementById("dataList");
        container.innerHTML = "";
        data.slice(1).forEach(row => {
          if (row[0]) {
            const div = document.createElement("div");
            div.className = "code-card";
            div.innerHTML = `
              <strong>${row[1]}</strong> - ${row[2]}<br>
              <pre>${row[3]}</pre>
              ${row[4] ? `<img src="${row[4]}" width="100"><br>` : ""}
              <button onclick="editEntry('${row[0]}','${row[1]}','${row[2]}',\`${row[3].replace(/`/g, "\\`")}\`,'${row[4] || ""}')">Edit</button>
              <button onclick="deleteEntry('${row[0]}')">Delete</button>
            `;
            container.appendChild(div);
          }
        });
      } catch (e) {
        console.error("Error loading data:", text);
      }
    }

    // ðŸŸ¡ Edit Function
    function editEntry(id, name, description, code, image) {
      document.getElementById("id").value = id;
      document.getElementById("name").value = name;
      document.getElementById("description").value = description;
      document.getElementById("code").value = code;
      document.getElementById("image").value = image;
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    // ðŸ”´ Delete Function
    async function deleteEntry(id) {
      if (confirm("Are you sure you want to delete this entry?")) {
        const formData = new FormData();
        formData.append("action", "delete");
        formData.append("id", id);
        const response = await fetch(scriptURL, { method: "POST", body: formData });
        alert(await response.text());
        loadData();
      }
    }

    loadData();
  </script>
</body>
</html>

